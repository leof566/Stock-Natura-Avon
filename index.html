<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Mi Stock Natura</title>
  <meta name="theme-color" content="#ff7a00" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <style>
    :root{--naranja:#ff7a00;--naranja-osc:#d86500;--bg:#0f0f0f;--panel:#171717;--text:#f2f2f2;--muted:#a7a7a7;--ok:#22c55e;--bad:#ef4444}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:960px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border-radius:16px;padding:16px;box-shadow:0 6px 30px rgba(0,0,0,.35)}
    .title{display:flex;align-items:center;gap:10px;font-weight:800;font-size:22px;margin:0 0 12px}
    .badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;background:var(--naranja);color:#111}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:700px){.row{grid-template-columns:1fr 1fr}}
    label{font-size:13px;color:var(--muted)}
    input,select,button{width:100%;border-radius:12px;border:1px solid #2a2a2a;background:#121212;color:var(--text);padding:12px;font-size:16px}
    input:focus,select:focus{outline:2px solid var(--naranja)}
    button{background:var(--naranja);color:#111;border:none;font-weight:700;cursor:pointer}
    button:hover{background:var(--naranja-osc)}
    .btn-ghost{background:#1b1b1b;color:var(--text);border:1px solid #2a2a2a}
    .grid{display:grid;gap:12px}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #2a2a2a;padding:10px;text-align:left;font-size:14px}
    .state{font-weight:800}
    .state.dispo{color:var(--ok)}
    .state.vend{color:var(--bad)}
    .chip{border:1px solid #2a2a2a;padding:8px;border-radius:12px;display:inline-flex;align-items:center;gap:8px}
    .switch{display:inline-flex;gap:8px;align-items:center}
    .tiny{font-size:12px;color:var(--muted)}
    .scan-preview{position:relative;border:2px dashed #2a2a2a;border-radius:12px;overflow:hidden;height:240px;background:#0b0b0b;display:flex;align-items:center;justify-content:center}
    .scan-preview video{width:100%;height:100%;object-fit:cover}
    .scan-overlay{position:absolute;inset:0;pointer-events:none;border:2px solid var(--naranja);border-radius:16px;margin:24px}
    .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #2a2a2a;border-radius:999px;padding:6px 10px}
    .link{color:#ffd1b0;text-decoration:underline;cursor:pointer}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:100}
    .modal .box{background:var(--panel);border-radius:16px;padding:16px;max-width:600px;width:90%;max-height:70vh;overflow:auto}
    .toast{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);background:#1b1b1b;border:1px solid #2a2a2a;border-radius:999px;padding:10px 14px;display:none;z-index:101}
    /* Calculadora */
    .calc{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .calc .display{grid-column:1/-1;font-size:22px;text-align:right;padding:14px;background:#101010;border-radius:12px;border:1px solid #2a2a2a;min-height:48px}
    .calc button{padding:14px}
    .calc .wide{grid-column: span 2}
  </style>
  <!-- LibrerÃ­as (cacheadas para offline por el SW) -->
  <script defer src="https://unpkg.com/@zxing/browser@0.1.5"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <div class="wrap">
    <h1 class="title">ðŸ§¡ Mi Stock Natura <span class="badge">PWA</span></h1>

    <div class="card grid">
      <div class="grid">
        <h2 style="margin:0">Agregar producto</h2>
        <div class="row">
          <div>
            <label>Nombre del producto</label>
            <input id="name" placeholder="Ej.: Perfume Kriska" />
          </div>
          <div>
            <label>CÃ³digo de barras</label>
            <input id="barcode" inputmode="numeric" placeholder="EscaneÃ¡ o escribÃ­" />
          </div>
          <div>
            <label>Precio (ARS)</label>
            <input id="price" inputmode="decimal" placeholder="Ej.: 12999" />
          </div>
          <div>
            <label>GÃ©nero (F/M)</label>
            <div class="chip">
              <label class="switch"><input type="checkbox" id="isFemale"> <span>F</span></label>
              <label class="switch"><input type="checkbox" id="isMale"> <span>M</span></label>
            </div>
          </div>
          <div>
            <label>Estado</label>
            <select id="status">
              <option value="DISPONIBLE">DISPONIBLE</option>
              <option value="VENDIDO">VENDIDO</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;align-items:end">
            <button id="addBtn">Agregar</button>
            <button class="btn-ghost" id="scanBtn">ðŸ“· Escanear</button>
            <button id="quickSaleBtn">âš¡ Venta rÃ¡pida</button>
          </div>
        </div>
        <div class="scan-preview" id="scanBox" style="display:none">
          <video id="video" playsinline></video>
          <div class="scan-overlay"></div>
        </div>
        <span class="tiny">Tip: si el lector no estÃ¡ disponible, podÃ©s escribir el cÃ³digo manualmente.</span>
      </div>

      <div class="grid">
        <h2 style="margin:0">Inventario</h2>
        <div class="toolbar">
          <input id="search" placeholder="Buscar por nombre o cÃ³digo" style="max-width:300px" />
          <select id="filterState" style="max-width:180px">
            <option value="ALL">Todos</option>
            <option value="DISPONIBLE">DISPONIBLE</option>
            <option value="VENDIDO">VENDIDO</option>
          </select>
          <select id="dateMode" style="max-width:200px">
            <option value="CREACION">Por creaciÃ³n</option>
            <option value="VENTA">Por venta</option>
          </select>
          <input type="date" id="dateFrom" style="max-width:170px" />
          <input type="date" id="dateTo" style="max-width:170px" />
          <button id="exportExcel">Exportar Excel</button>
          <button id="exportPDF">Exportar PDF</button>
          <button class="btn-ghost" id="backupBtn">Backup JSON</button>
          <label class="pill">Importar JSON <input type="file" id="restoreFile" accept="application/json" style="display:none"></label>
        </div>
        <div class="tiny">Copia automÃ¡tica local: <span id="autoStamp">-</span></div>
        <table class="table" id="table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>CÃ³digo</th>
              <th>Precio</th>
              <th>F</th>
              <th>M</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Deudores -->
    <div class="card grid">
      <div class="grid">
        <h2 style="margin:0">Deudores</h2>
        <div class="row">
          <div>
            <label>Nombre del deudor</label>
            <input id="debName" placeholder="Ej.: Ana PÃ©rez" />
          </div>
          <div>
            <label>Deuda inicial (ARS)</label>
            <input id="debAmount" inputmode="decimal" placeholder="Ej.: 15000" />
          </div>
          <div style="display:flex;gap:8px;align-items:end">
            <button id="debAddBtn">Agregar deudor</button>
          </div>
        </div>
        <div class="toolbar">
          <input id="debSearch" placeholder="Buscar deudor" style="max-width:300px"/>
          <button id="debExportExcel">Exportar Deudores</button>
        </div>
        <table class="table" id="debTable">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Deuda total</th>
              <th>Pagado</th>
              <th>Saldo</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="debTbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Calculadora -->
    <div class="card grid">
      <div class="grid">
        <h2 style="margin:0">Calculadora</h2>
        <div class="calc">
          <div id="calcDisplay" class="display">0</div>
          <button class="btn-ghost" data-c="C">C</button>
          <button class="btn-ghost" data-c="(">(</button>
          <button class="btn-ghost" data-c=")">)</button>
          <button data-c="Ã·">Ã·</button>
          <button data-c="7">7</button>
          <button data-c="8">8</button>
          <button data-c="9">9</button>
          <button data-c="Ã—">Ã—</button>
          <button data-c="4">4</button>
          <button data-c="5">5</button>
          <button data-c="6">6</button>
          <button data-c="-">-</button>
          <button data-c="1">1</button>
          <button data-c="2">2</button>
          <button data-c="3">3</button>
          <button data-c="+">+</button>
          <button class="wide btn-ghost" data-c="âŒ«">âŒ«</button>
          <button class="wide" data-c="=">=</button>
          <button class="wide btn-ghost" data-c=".">.</button>
          <button class="wide btn-ghost" data-c="%">%</button>
        </div>
      </div>
    </div>

    <p class="tiny">Hecho con ðŸ§¡ para Natura. DiseÃ±o naranja, moderno y pensado para usar en el celular. â€” <span class="link" id="installHint">Â¿CÃ³mo instalar como app?</span></p>
  </div>

  <!-- Historial (modal) -->
  <div id="historyModal" class="modal">
    <div class="box">
      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
        <h3 style="margin:0">Historial</h3>
        <button class="btn-ghost" id="closeHist">Cerrar</button>
      </div>
      <div id="historyContent" class="tiny"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Canvas oculto para procesar frames (BarcodeDetector) -->
  <canvas id="grabCanvas" width="640" height="480" style="display:none"></canvas>

  <!-- Beep embebido (base64, cortito) -->
  <audio id="beep" preload="auto" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQgAAAAA/////wAAAP///wAAAP///wAAAP///wAAAP///wAAAP///wAAAP///wAAAP8=" ></audio>
</body>
</html>
